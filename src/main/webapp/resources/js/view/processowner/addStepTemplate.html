<div data-role="header" id="header">
	<h1>Aggiungi passo</h1>
	<div class="ui-btn-left">
		<a id="options" data-role="button" data-iconpos="notext" data-icon="bars">Opzioni</a>
		<a href="#home" data-role="button" data-iconpos="notext" data-icon="home">Home</a>
	</div>
</div><!-- /header -->

<div data-role="content" id="content" class="searchList">

	<form id="addStepForm" accept-charset="utf-8" data-block="<%= blockId %>" data-step="<%= step.id %>">

		<ul data-role="listview" data-inset="true">
			<li data-role="fieldcontain">
				<label for="stepDescription">Descrizione passo:</label>
				<input type="text" pattern="(\w| )*\w+(\w| )*" id="processName" maxlength="25" value="<%= step.description ? step.description : null %>" required />
			</li>
			<li data-role="fieldcontain">
				<label for="requiresApproval">Richiede approvazione</label>
				<input type="checkbox" id="requiresApproval" <%= step.requiresApproval ? "checked" : null %>/>
				<label for="optional">Passo opzionale</label>
				<input type="checkbox" id="optional" <%= step.optional ? "checked" : null %>/>
				<p class="label">Aggiungi dato:</p>
				<% if( step ) {
					var textualData = step.textualData;
					var _textualData = step._textualData;
					var imageData = step.imageData;
					var _imageData = step._imageData;
					var numericData = step.numericData;
					var _numericData = step._numericData;
				} if(!((textualData||_textualData)&&(imageData||_imageData)&&(numericData||_numericData))) { %>
					<div data-role="controlgroup" data-type="horizontal" id="buttonsArea" data-corners="false">
						<% if( !textualData && !_textualData ) { %>
							<button data-mini="true" data-inline="false" id="showTextualData">Testuale</button>
						<% } if( !imageData && !_imageData ) { %>
							<button data-mini="true" data-inline="false" id="showImageData">Immagine</button>
						<% } if( !numericData && !_numericData ) { %>
							<button data-mini="true" data-inline="false" id="showNumericData">Numerico</button>
						<% } %>
						<button data-role="button" data-icon="info" data-mini="true" class="helpButton"></button>
					</div>
				<% } %>
		
			</li>
		</ul>

		<div class="hide<%= textualData || _textualData ? " visible" : null %>">
			<ul data-role="listview" data-inset="true" id="textualDataList">
				<li data-role="list-divider" class="add-data">
					<button data-icon="plus" data-mini="true" data-inline="true" id="addTextualData">Dato testuale</button>
				</li>
				<% if(_textualData) { _.each( _textualData, function( data ) { %>
					<li data-role="fieldcontain" class="data-item">
						<div>
							<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
						</div>
						<div class="textualData">
							<label>Etichetta dato:</label>
							<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= data.description %>"/>
						</div>
					</li>
				<% }); } else { _.each( textualData, function( data ) { %>
					<li data-role="fieldcontain" class="data-item">
						<div>
							<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
						</div>
						<div class="textualData">
							<label>Etichetta dato:</label>
							<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= data.description %>"/>
						</div>
					</li>
				<% }); } %>
				<li data-role="fieldcontain" class="data-item">
					<div>
						<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
					</div>
					<div class="textualData">
						<label>Etichetta dato:</label>
						<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25"/>
					</div>
				</li>
			</ul>
		</div>

		<div class="hide<%= imageData || _imageData ? " visible" : null %>">
			<ul data-role="listview" data-inset="true" id="imageDataList">
				<li data-role="list-divider" class="add-data">
					<button data-icon="plus" data-mini="true" data-inline="true" id="addImageData">Immagine</button>
				</li>
				<% if(_imageData) { _.each( _imageData, function( data ) { %>
					<li data-role="fieldcontain" class="data-item">
						<div>
							<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
						</div>
						<div class="imageData">
							<label>Etichetta immagine:</label>
							<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= data.description %>"/>
						</div>
					</li>
				<% }); } else { _.each( imageData, function( data ) { %>
					<li data-role="fieldcontain" class="data-item">
						<div>
							<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
						</div>
						<div class="imageData">
							<label for="stepDescription">Etichetta immagine:</label>
							<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= data.description %>"/>
						</div>
					</li>
				<% }); } %>
				<li data-role="fieldcontain" class="data-item">
					<div>
						<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
					</div>
					<div class="imageData">
						<label>Etichetta immagine:</label>
						<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25"/>
					</div>
				</li>
			</ul>
		</div>

		<div class="hide<%= numericData || _numericData ? " visible" : null %>">
			<ul data-role="listview" data-inset="true" id="numericDataList">
				<li data-role="list-divider" class="add-data">
					<button data-icon="plus" data-mini="true" data-inline="true" id="addNumericData">Dato numerico</button>
				</li>
				<% if(_numericData) { for(var i=0; i<_numericData.length; i++) { %>
					<li data-role="fieldcontain" class="data-item">
						<div>
							<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
						</div>
						<div class="numericData">
							<label>Etichetta dato:</label>
							<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= _numericData[i].description %>"/>
							<label for="isDecimal<%= i %>">Cifre decimali permesse</label>
							<input type="checkbox" id="isDecimal<%= i %>" <%= _numericData[i].isDecimal ? "checked" : null %>/>
							<input type="checkbox" id="minValueCheck<%= i %>" class="checkButton" <%= _numericData[i].minValue ? "checked" : null %>/>
							<label for="minValueCheck<%= i %>">Valore minimo</label>
							<div class="hide<%= _numericData[i].minValue ? " visible" : null %>">
								<input type="number" id="minValue-<%= i %>" min="-999999999" max="999999999" value="<%= _numericData[i].minValue %>"/>
							</div>
							<input type="checkbox" id="maxValueCheck<%= i %>" class="checkButton" <%= _numericData[i].maxValue ? "checked" : null %>/>
							<label for="maxValueCheck<%= i %>">Valore massimo</label>
							<div class="hide<%= _numericData[i].maxValue ? " visible" : null %>">
								<input type="number" id="maxValue-<%= i %>" min="-999999999" max="999999999" value="<%= _numericData[i].maxValue %>"/>
							</div>
						</div>
					</li>
				<% }} else if(numericData) { for(var i=0; i<numericData.length; i++) { %>
					<li data-role="fieldcontain" class="data-item">
						<div>
							<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
						</div>
						<div class="numericData">
							<label>Etichetta dato:</label>
							<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= numericData[i].description %>"/>
							<label for="isDecimal<%= i %>">Cifre decimali permesse</label>
							<input type="checkbox" id="isDecimal<%= i %>" <%= numericData[i].isDecimal ? "checked" : null %>/>
							<input type="checkbox" id="minValueCheck<%= i %>" class="checkButton" <%= numericData[i].minValue ? "checked" : null %>/>
							<label for="minValueCheck<%= i %>">Valore minimo</label>
							<div class="hide<%= numericData[i].minValue ? " visible" : null %>">
								<input type="number" id="minValue-<%= i %>" min="-999999999" max="999999999" value="<%= numericData[i].minValue %>"/>
							</div>
							<input type="checkbox" id="maxValueCheck<%= i %>" class="checkButton" <%= numericData[i].maxValue ? "checked" : null %>/>
							<label for="maxValueCheck<%= i %>">Valore massimo</label>
							<div class="hide<%= numericData[i].maxValue ? " visible" : null %>">
								<input type="number" id="maxValue-<%= i %>" min="-999999999" max="999999999" value="<%= numericData[i].maxValue %>"/>
							</div>
						</div>
					</li>
				<% }} %>
				<li data-role="fieldcontain" class="data-item">
					<div>
						<a href="" class="delete-data" title="elimina dato" data-role="button" data-iconpos="notext" data-icon="delete"></a>
					</div>
					<div class="numericData">
						<label for="stepDescription">Etichetta dato:</label>
						<input type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25"/>
						<label for="isDecimal">Cifre decimali permesse</label>
						<input type="checkbox" id="isDecimal"/>
						<input type="checkbox" id="minValueCheck" class="checkButton"/>
						<label for="minValueCheck">Valore minimo</label>
						<div class="hide">
							<input type="number" id="minValue" min="-999999999" max="999999999"/>
						</div>
						<input type="checkbox" id="maxValueCheck" class="checkButton"/>
						<label for="maxValueCheck">Valore massimo</label>
						<div class="hide">
							<input type="number" id="maxValue" min="-999999999" max="999999999"/>
						</div>
					</div>
				</li>
			</ul>
		</div>

		<ul data-role="listview" data-inset="true" id="geographicData">
			<% if( step.geographicData ) {
				var geographicData = step.geographicData
			} %>
			<li data-role="list-divider">
				<label for="geographicDataCheck">Vincoli geografici</label>
				<input type="checkbox" id="geographicDataCheck" <%= geographicData ? "checked" : null %>/>
			</li>
			<li data-role="fieldcontain">
				<label for="latitude">Latitudine:</label>
				<input id="latitude" type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= geographicData ? geographicData.latitude : null %>"/>
			</li>
			<li data-role="fieldcontain" id="longitudeBox">
				<label for="longitude">Longitudine:</label>
				<input id="longitude" type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= geographicData ? geographicData.longitude : null %>"/>
			</li>
			<li data-role="fieldcontain" id="radiusBox">
				<label for="radius">Raggio:</label>
				<input id="radius" type="text" pattern="(\w| )*\w+(\w| )*" maxlength="25" value="<%= geographicData ? geographicData.radius : null %>"/>
			</li>
		</ul>

		<div data-role="controlgroup" data-type="horizontal">
			<button type="submit" data-icon="check" data-inline="true" data-mini="true" id="saveDescription">Salva descrizione</button>
			<button data-icon="forbidden" data-inline="true" data-mini="true" id="cancelDescription">Annulla</button>
		</div>
	
	</form>

</div><!-- /content -->

<div data-role="panel" id="panel" data-position="left" data-display="overlay">
	
	<button data-rel="close" data-icon="delete" data-mini="true">Chiudi pannello</button>

	<p>Ciao <%= username %>!</p>
	
	<a data-role="button" id="logout" data-icon="power">Logout</a>

</div><!-- panel -->

<div data-role="popup" class="alertPanel" data-overlay-theme="a" data-history="false" data-corners="false">
	<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
	<div data-role="header">
		<h3></h3>
	</div>
	<div role="main" class="ui-content">
		<p></p>
	</div>
</div><!-- /alert -->

<div data-role="popup" id="blocksHelp" data-overlay-theme="a" data-history="false" data-corners="false">
	<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
	<div data-role="header">
		<h3>Blocchi</h3>
	</div>
	<div role="main" class="ui-content">
		<p><strong>Sequenziale:</strong></p>
		<p>blocco che consente di stabilire l'ordine con cui dovranno essere eseguiti i passi.</p>
		<p><strong>Non ordinato:</strong></p>
		<p>blocco i cui passi possono essere eseguiti con ordine a piacere.</p>
	</div>
</div><!-- /blocksHelp -->